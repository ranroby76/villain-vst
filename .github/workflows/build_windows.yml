name: Build Windows (VST3)

on:
  push:
    branches:
      - master
  workflow_dispatch:

jobs:
  build_windows:
    name: Build Windows VST3
    runs-on: windows-latest
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          lfs: true

      - name: Clone JUCE 7.0.12 Framework
        run: |
          git clone --depth 1 --branch 7.0.12 https://github.com/juce-framework/JUCE.git libs/JUCE

      - name: Configure CMake
        run: |
          cmake -B build -G "Visual Studio 17 2022" -A x64 `
            -DCMAKE_BUILD_TYPE=Release `
            -DJUCE_DIR=libs/JUCE `
            -DVILLAIN_ENABLE_VST3=ON `
            -DVILLAIN_ENABLE_AU=OFF `
            -DVILLAIN_ENABLE_CLAP=OFF

      - name: Build VST3
        run: cmake --build build --config Release --parallel 4

      - name: Upload VST3 Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Villain-Windows-VST3
          path: build/Villain_artefacts/Release/VST3/Villain.vst3